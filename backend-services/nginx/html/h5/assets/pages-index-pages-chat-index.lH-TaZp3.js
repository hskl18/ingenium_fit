var e=(e,t,r)=>new Promise((a,n)=>{var l=e=>{try{u(r.next(e))}catch(t){n(t)}},o=e=>{try{u(r.throw(e))}catch(t){n(t)}},u=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,o);u((r=r.apply(e,t)).next())});import{d as t,u as r,b as a,r as n,c as l,J as o,i as u,w as s,a5 as i,Y as c,M as f,N as d,Q as p,a6 as m,C as x,f as v,g as y,_ as h,h as g,o as b,k as _,j,p as w,z as k,s as I,F as T,v as O,m as N,q as S,t as z,n as C,H as F,x as U,a7 as V,a8 as B,a9 as M,aa as P,I as Q}from"./index-D9qffpGI.js";import{_ as $}from"./z-paging.CK8cOFJo.js";import{u as A}from"./useQueue.DfwZUzlk.js";import"./z-paging-empty-view.D2R4CSV8.js";import"./common-layout.D4krRS1d.js";var E="object"==typeof global&&global&&global.Object===Object&&global,W="object"==typeof self&&self&&self.Object===Object&&self,q=E||W||Function("return this")(),D=q.Symbol,H=Object.prototype,J=H.hasOwnProperty,L=H.toString,Y=D?D.toStringTag:void 0;var G=Object.prototype.toString;var K=D?D.toStringTag:void 0;function R(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":K&&K in Object(e)?function(e){var t=J.call(e,Y),r=e[Y];try{e[Y]=void 0;var a=!0}catch(l){}var n=L.call(e);return a&&(t?e[Y]=r:delete e[Y]),n}(e):function(e){return G.call(e)}(e)}var X=/\s/;var Z=/^\s+/;function ee(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&X.test(e.charAt(t)););return t}(e)+1).replace(Z,""):e}function te(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var re=/^[-+]0x[0-9a-f]+$/i,ae=/^0b[01]+$/i,ne=/^0o[0-7]+$/i,le=parseInt;function oe(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==R(e)}(e))return NaN;if(te(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=te(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=ee(e);var r=ae.test(e);return r||ne.test(e)?le(e.slice(2),r?2:8):re.test(e)?NaN:+e}var ue=function(){return q.Date.now()},se=Math.max,ie=Math.min;function ce(e,t,r){var a,n,l,o,u,s,i=0,c=!1,f=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var r=a,l=n;return a=n=void 0,i=t,o=e.apply(l,r)}function m(e){var r=e-s;return void 0===s||r>=t||r<0||f&&e-i>=l}function x(){var e=ue();if(m(e))return v(e);u=setTimeout(x,function(e){var r=t-(e-s);return f?ie(r,l-(e-i)):r}(e))}function v(e){return u=void 0,d&&a?p(e):(a=n=void 0,o)}function y(){var e=ue(),r=m(e);if(a=arguments,n=this,s=e,r){if(void 0===u)return function(e){return i=e,u=setTimeout(x,t),c?p(e):o}(s);if(f)return clearTimeout(u),u=setTimeout(x,t),p(s)}return void 0===u&&(u=setTimeout(x,t)),o}return t=oe(t)||0,te(r)&&(c=!0,l=(f="maxWait"in r)?se(oe(r.maxWait)||0,t):l,d=!("trailing"in r)&&d),y.cancel=function(){void 0!==u&&clearTimeout(u),i=0,a=s=n=u=void 0},y.flush=function(){return void 0===u?o:v(ue())},y}const fe=Q(t({__name:"index",props:{userId:{}},setup(t){const Q=t,{t:E}=r();p("dayjs");const W=p("timeAgo"),{closeOutside:q}=A(),D=a(),H=n(""),J=n([]),L=n(),Y=n({}),G=n(0),K=l(()=>m(136));function R(e,t){const r=e.createTime;return 0===t||J.value[t-1].createTime-r>3e5?W.format(+r):void 0}function X(){f(()=>{var e;null==(e=L.value)||e.scrollToBottom(!1)})}function Z({height:e}){G.value=e,X()}function ee(){G.value=0,X()}const te=ce(function(){return e(this,null,function*(){var e;if(H.value)try{yield B({userId:Q.userId,content:H.value});yield M({title:E("pages-index.chat.prompt.send-successfully"),icon:"none"}),null==(e=L.value)||e.refresh(),H.value=""}catch(t){}})},x.debounceLongTime,{leading:!0,trailing:!1});function re(t,r){return e(this,null,function*(){var e,a;try{const a=yield P({pageNum:t,pageSize:r,userId:Q.userId});null==(e=L.value)||e.complete(a.rows||[])}catch(n){null==(a=L.value)||a.complete(!1)}})}return o(()=>{!function(){e(this,null,function*(){try{const t=yield i({userId:Q.userId});Y.value=t.data||{},yield c({title:Y.value.userNickName}),f(()=>e(null,null,function*(){var e;null==(e=L.value)||e.refresh()}))}catch(t){}})}()}),(e,t)=>{const r=j,a=C,n=U,l=v(y("z-paging"),$),o=v(y("wd-input"),h),i=v(y("wd-button"),g),c=d("layout-default-uni");return b(),u(c,null,{default:s(()=>[_(r,{onClick:w(q)},{default:s(()=>[_(l,{ref_key:"paging",ref:L,auto:!1,modelValue:w(J),"onUpdate:modelValue":t[0]||(t[0]=e=>k(J)?J.value=e:null),"use-chat-record-mode":"","safe-area-inset-bottom":"","auto-to-bottom-when-chat":"","auto-adjust-position-when-chat":!1,onQuery:re},{bottom:s(()=>[_(r,{style:V([{height:w(K)+"px"}])},null,8,["style"])]),default:s(()=>[(b(!0),I(T,null,O(w(J),(e,t)=>(b(),u(r,{class:"p-[28rpx+20rpx+24rpx] scale-y-[-1]",key:e.id},{default:s(()=>{var l;return[R(e,t)?(b(),u(r,{key:0,class:"mb-32rpx text-center text-28rpx text-#999"},{default:s(()=>[S(z(R(e,t)),1)]),_:2},1024)):N("",!0),e.createBy===(null==(l=w(D).userInfo)?void 0:l.id)?(b(),u(r,{key:1,class:"flex flex-row-reverse"},{default:s(()=>{var t,l;return[_(a,{class:F(["shrink-0 mr-16rpx w-86rpx h-86rpx rounded-full",{"ml-16rpx !mr-0":e.createBy===(null==(t=w(D).userInfo)?void 0:t.id)}]),src:e.employerUserImageUrl},null,8,["class","src"]),_(r,{class:F(["max-w-506rpx flex flex-col items-start",{"!items-end":e.createBy===(null==(l=w(D).userInfo)?void 0:l.id)}])},{default:s(()=>[_(r,{class:"p-20rpx bg-#02989F rounded-20rpx"},{default:s(()=>[_(n,{class:"text-30rpx text-#fff break-all"},{default:s(()=>[S(z(e.content),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])]}),_:2},1024)):(b(),u(r,{key:2,class:"flex"},{default:s(()=>[_(a,{class:"shrink-0 mr-16rpx w-86rpx h-86rpx rounded-full",src:e.servantUserImageUrl},null,8,["src"]),_(r,{class:"max-w-506rpx flex flex-col items-start"},{default:s(()=>[_(r,{class:"p-20rpx bg-white rounded-20rpx"},{default:s(()=>[_(n,{class:"text-30rpx text-#333 break-all"},{default:s(()=>[S(z(e.content),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))]}),_:2},1024))),128))]),_:1},8,["modelValue"]),_(r,{class:"fixed bottom-0 left-0 right-0 py-28rpx px-24rpx flex items-center space-x-20rpx bg-#fff rounded-t-56rpx shadow-[0rpx_8rpx_20rpx_0rpx_rgba(0,0,0,0.16)]"},{default:s(()=>[_(r,{class:"flex-1 h-80rpx flex items-center bg-#F6F6F6 rounded-40rpx"},{default:s(()=>[_(o,{"no-border":"",clearable:"",maxlength:500,adjustPosition:!1,cursorSpacing:20,"confirm-type":"send",modelValue:w(H),"onUpdate:modelValue":t[1]||(t[1]=e=>k(H)?H.value=e:null),modelModifiers:{trim:!0},placeholder:w(E)("pages-index.chat.input-placeholder.content"),placeholderStyle:"font-size: 28rpx;line-height: 40rpx;color: #999999;",class:"relative flex-1 z-10 px-28rpx !bg-transparent !after:bg-transparent",onFocus:Z,onBlur:ee,onConfirm:w(te)},null,8,["modelValue","placeholder","onConfirm"])]),_:1}),_(r,{class:"flex"},{default:s(()=>[_(i,{"custom-class":"!w-138rpx !h-80rpx !min-w-auto !rounded-16rpx",type:"primary",onClick:w(te)},{default:s(()=>[S(z(w(E)("common.send")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})}}}),[["__scopeId","data-v-37c89910"]]);export{fe as default};
