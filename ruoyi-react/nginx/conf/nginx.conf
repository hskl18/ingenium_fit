worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    client_max_body_size 500m;

   upstream systemList {
         server system:8080;
   }

    server {
        listen       80;
        server_name  localhost;

        #gzip
        #开启gzip功能
        gzip on;

        #gzip缓存大小
        gzip_buffers 4 16k;

        #gzip http版本
        gzip_http_version 1.1;

        #gzip 压缩级别 1-10
        gzip_comp_level 5;

        #gzip 压缩类型
        gzip_types text/plain application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;

        # 是否在http header中添加Vary: Accept-Encoding，建议开启
        gzip_vary on;

        location /prod-api/ {
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header REMOTE-HOST $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_pass http://systemList/;
        }

        location /prod-api/api/ {
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header REMOTE-HOST $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_pass http://systemList/;
        }

        location /admin {
            root   /home/xgwy/ruoyi-ui/;
            try_files $uri $uri/ /admin/index.html;
            index  index.html index.htm;
        }

        location /h5 {
            root   /home/xgwy/ruoyi-ui/;
            try_files $uri $uri/ /h5/index.html;
            index  index.html index.htm;
        }

        location / {
            root   /home/xgwy/ruoyi-ui/dist;
            try_files $uri $uri/ /index.html;
            index  index.html index.htm;
        }

        # 避免actuator暴露
        if ($request_uri ~ "/actuator") {
            return 403;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }



    }


#     server {
#         listen       443;
#         server_name  localhost;
#
#         ssl_certificate      ./ssl/cert.pem;
#         ssl_certificate_key  ./ssl/cert.key;
#
#         ssl_session_cache    shared:SSL:1m;
#         ssl_session_timeout  5m;
#
#         ssl_ciphers  HIGH:!aNULL:!MD5;
#         ssl_prefer_server_ciphers  on;
#
#         #gzip
#         #开启gzip功能
#         gzip on;
#
#         #gzip缓存大小
#         gzip_buffers 4 16k;
#
#         #gzip http版本
#         gzip_http_version 1.1;
#
#         #gzip 压缩级别 1-10
#         gzip_comp_level 5;
#
#         #gzip 压缩类型
#         gzip_types text/plain application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
#
#         # 是否在http header中添加Vary: Accept-Encoding，建议开启
#         gzip_vary on;
#
#         #nacos phpmyadmin 正式环境不需要
#         location /nacos/ {
#             # Nacos地址服务器寻址配置
#             proxy_pass  http://nacosServerList/nacos/;
#         }
#
#         location /phpmyadmin/ {
#             # 替换为您的PHPMYADMIN实际运行的端口号
#             proxy_pass http://localhost:8088/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }
#
#         location /prod-api/ {
#             proxy_set_header Host $http_host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header REMOTE-HOST $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_pass http://localhost:8080/;
#         }
#
#         location /business {
#             root   /home/ziyuan/ruoyi-ui;
#             try_files $uri $uri/ /index.html;
#             index  index.html index.htm;
#             expires -1;
#             if_modified_since off;
#             add_header Last-Modified "";
#             add_header Cache-Control no-cache;
#             etag off;
#         }
#
#         location / {
#             root   /home/ziyuan/ruoyi-ui/dist;
#             try_files $uri $uri/ /index.html;
#             index  index.html index.htm;
#         }
#
#         # 避免actuator暴露
#         if ($request_uri ~ "/actuator") {
#             return 403;
#         }
#
#         error_page   500 502 503 504  /50x.html;
#         location = /50x.html {
#             root   html;
#         }
#     }

}
